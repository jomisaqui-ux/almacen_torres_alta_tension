<!DOCTYPE html>
<html>
<head>
    <style>
        @page {
            size: A4;
            margin: 1cm;
            @frame footer_frame {
                -pdf-frame-content: footerContent;
                bottom: 1cm;
                margin-left: 1cm;
                margin-right: 1cm;
                height: 1cm;
            }
        }
        body {
            font-family: Helvetica, sans-serif;
            font-size: 10pt;
            line-height: 1.3;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        .title {
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            text-transform: uppercase;
            color: #2c3e50;
        }
        .content {
            margin-bottom: 15px;
            text-align: justify;
        }
        .worker-data {
            background-color: #f8f9fa;
            padding: 5px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            font-size: 9pt;
        }
        .table-items {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 9pt;
        }
        .table-items th, .table-items td {
            border: 1px solid #999;
            padding: 3px;
            text-align: left;
            vertical-align: middle;
        }
        .table-items th {
            background-color: #2c3e50;
            color: white;
            text-align: center;
        }
        .legal-text {
            font-size: 8pt;
            color: #555;
            margin-top: 15px;
            margin-bottom: 30px;
            text-align: justify;
            border: 1px dashed #ccc;
            padding: 5px;
        }
        .signatures {
            margin-top: 40px;
            width: 100%;
        }
        .sign-box {
            text-align: center;
            border-top: 1px solid #000;
            padding-top: 5px;
            width: 35%;
            font-size: 9pt;
        }
    </style>
</head>
<body>
    <table style="width: 100%; border-bottom: 1px solid #333; margin-bottom: 10px; padding-bottom: 5px;">
        <tr>
            <td width="20%" valign="top">
                {% if config.logo %}
                    <img src="{{ config.logo.path }}" style="height: 60px;">
                {% endif %}
            </td>
            <td width="60%" align="center" valign="top">
                <h2 style="margin:0; color: #2c3e50;">{{ config.nombre_empresa|default:"EMPRESA DEMO" }}</h2>
                {% if config.ruc %}<p style="margin:0;">RUC: {{ config.ruc }}</p>{% endif %}
                <p style="margin:0;">Área de Logística y Almacén</p>
            </td>
            <td width="20%" align="right" valign="top">
                <img src="data:image/png;base64,{{ qr_code }}" style="width: 70px; height: 70px;">
            </td>
        </tr>
    </table>

    <div class="title">{{ titulo }}</div>

    <div class="content">
        <p>
            Por medio del presente documento, se detalla la relación de equipos, herramientas y/o EPPs asignados bajo responsabilidad al colaborador:
        </p>
        <div class="worker-data">
            <table width="100%">
                <tr>
                    <td><strong>TRABAJADOR:</strong> {{ trabajador.apellidos }}, {{ trabajador.nombres }}</td>
                    <td><strong>DNI:</strong> {{ trabajador.dni }}</td>
                </tr>
                <tr>
                    <td><strong>CARGO:</strong> {{ trabajador.cargo }}</td>
                    <td><strong>FECHA EMISIÓN:</strong> {% now "d/m/Y H:i" %}</td>
                </tr>
            </table>
        </div>
    </div>

    {% if tiene_deuda %}
        <h4 style="color: #c0392b; border-bottom: 1px solid #c0392b; padding-bottom: 5px; margin-bottom: 5px;">ACTIVOS PENDIENTES DE DEVOLUCIÓN</h4>
        <table class="table-items">
            <thead>
                <tr>
                    <th width="15%">CÓDIGO</th>
                    <th width="45%">DESCRIPCIÓN</th>
                    <th width="25%">MARCA / SERIE</th>
                    <th width="15%">FECHA ENTREGA</th>
                </tr>
            </thead>
            <tbody>
                {% for activo in activos %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activo.codigo }}</strong></td>
                    <td>{{ activo.nombre }}</td>
                    <td>{{ activo.marca }} {{ activo.serie }}</td>
                    <td style="text-align: center;">{{ activo.historial_asignaciones.last.fecha_asignacion|date:"d/m/Y" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="legal-text">
            <strong>DECLARACIÓN DE RESPONSABILIDAD:</strong><br>
            Declaro haber recibido los bienes descritos en buen estado de conservación y funcionamiento. Me comprometo a utilizarlos exclusivamente para las labores asignadas por la empresa y a devolverlos al término de la obra o cuando sean requeridos. Autorizo expresamente a <strong>{{ config.nombre_empresa|default:"LA EMPRESA" }}</strong> a descontar de mis haberes o liquidación de beneficios sociales el valor de reposición en caso de pérdida, daño por negligencia o no devolución de los mismos.
        </div>

    {% else %}
        <div style="border: 2px solid green; padding: 15px; text-align: center; margin: 20px 0;">
            <h3 style="color: green; margin: 0;">NO REGISTRA ADEUDOS PENDIENTES</h3>
            <p>El trabajador ha devuelto todos los equipos y herramientas asignados a su cargo.</p>
        </div>
    {% endif %}

    <table class="signatures">
        <tr>
            <td width="10%"></td>
            <td class="sign-box">
                <strong>ENTREGADO POR</strong><br>
                Almacén / Logística
            </td>
            <td width="10%"></td>
            <td class="sign-box">
                <strong>RECIBIDO CONFORME</strong><br>
                {{ trabajador.nombres }} {{ trabajador.apellidos }}<br>
                DNI: {{ trabajador.dni }}
            </td>
            <td width="10%"></td>
        </tr>
    </table>

    <div id="footerContent" style="text-align:center; font-size: 8pt; color: #999;">
        Generado por ERP Almacén Obra - Página <pdf:pagenumber> de <pdf:pagecount>
    </div>
</body>
</html>